<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FR491L3 √ó Raphael ‚Äî Project Board</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@500&family=Space+Grotesk:wght@500;600&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    :root {
      --bg: #0a0a0a;
      --surface: #141414;
      --surface-hover: #1a1a1a;
      --border: #2a2a2a;
      --text: #e8e8e8;
      --text-secondary: #999;
      --text-dim: #555;
      --accent: #ff4d00;
      --accent-dim: rgba(255, 77, 0, 0.15);
      --note-bg: #1a1a0a;
      --note-border: #4a4a00;
    }
    
    [data-theme="light"] {
      --bg: #fafafa;
      --surface: #ffffff;
      --surface-hover: #f5f5f5;
      --border: #e0e0e0;
      --text: #1a1a1a;
      --text-secondary: #666;
      --text-dim: #999;
      --accent: #ff4d00;
      --accent-dim: rgba(255, 77, 0, 0.1);
      --note-bg: #fffef0;
      --note-border: #e0d000;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg);
      min-height: 100vh;
      color: var(--text);
      font-size: 14px;
      line-height: 1.6;
      transition: background 0.3s, color 0.3s;
    }
    
    .mono { font-family: 'JetBrains Mono', monospace; }
    
    .container { max-width: 1400px; margin: 0 auto; padding: 24px; }
    
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 0 20px;
      border-bottom: 1px solid var(--border);
      margin-bottom: 24px;
    }
    
    .logo {
      font-family: 'JetBrains Mono', monospace;
      font-size: 12px;
      font-weight: 500;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .logo .accent { color: var(--accent); }
    .logo .dim { color: var(--text-dim); }
    
    .header-right { display: flex; align-items: center; gap: 12px; }
    
    .last-updated {
      font-family: 'JetBrains Mono', monospace;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-dim);
    }
    
    .header-btn {
      background: var(--surface);
      border: 1px solid var(--border);
      color: var(--text-secondary);
      padding: 6px 10px;
      cursor: pointer;
      font-size: 12px;
      font-family: 'JetBrains Mono', monospace;
      transition: all 0.2s;
    }
    
    .header-btn:hover {
      border-color: var(--accent);
      color: var(--accent);
    }
    
    .header-btn.has-notes {
      border-color: var(--note-border);
      color: #d4a000;
    }
    
    .board { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; }
    
    @media (max-width: 1200px) { .board { grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 600px) {
      .board { grid-template-columns: 1fr; }
      header { flex-direction: column; gap: 12px; }
      .header-right { width: 100%; justify-content: space-between; flex-wrap: wrap; }
    }
    
    .column {
      background: var(--surface);
      border: 1px solid var(--border);
      min-height: 400px;
    }
    
    .column-header {
      font-family: 'JetBrains Mono', monospace;
      font-size: 10px;
      font-weight: 500;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      padding: 14px 16px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .column-ideas .column-header { color: #fbbf24; }
    .column-in-progress .column-header { color: #60a5fa; }
    .column-blocked .column-header { color: #f87171; }
    .column-done .column-header { color: #22c55e; }
    
    .column-count {
      background: var(--bg);
      border: 1px solid var(--border);
      padding: 2px 8px;
      font-size: 10px;
      color: var(--text-secondary);
    }
    
    .cards { padding: 12px; display: flex; flex-direction: column; gap: 8px; }
    
    .card {
      background: var(--bg);
      border: 1px solid var(--border);
      padding: 14px;
      transition: all 0.15s;
    }
    
    .card:hover { border-color: var(--accent); background: var(--surface-hover); }
    .card.has-note { border-left: 3px solid var(--note-border); }
    
    .card-title {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 14px;
      font-weight: 500;
      line-height: 1.4;
      margin-bottom: 6px;
    }
    
    .card-description {
      font-size: 12px;
      line-height: 1.5;
      color: var(--text-secondary);
      margin-bottom: 10px;
    }
    
    .card-tags { display: flex; flex-wrap: wrap; gap: 4px; }
    
    .tag {
      font-family: 'JetBrains Mono', monospace;
      font-size: 9px;
      padding: 3px 6px;
      text-transform: uppercase;
      letter-spacing: 0.03em;
      border: 1px solid var(--border);
      color: var(--text-dim);
    }
    
    .tag-passive-income { border-color: #059669; color: #059669; }
    .tag-content { border-color: #7c3aed; color: #7c3aed; }
    .tag-infrastructure { border-color: #2563eb; color: #2563eb; }
    .tag-app { border-color: #db2777; color: #db2777; }
    .tag-quick-win { border-color: #d97706; color: #d97706; }
    .tag-planning { border-color: #6366f1; color: #6366f1; }
    .tag-milestone { border-color: #10b981; color: #10b981; }
    
    .completed-date {
      font-family: 'JetBrains Mono', monospace;
      font-size: 9px;
      color: #22c55e;
      margin-top: 8px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    /* Notes */
    .card-note-toggle {
      font-family: 'JetBrains Mono', monospace;
      font-size: 9px;
      color: var(--text-dim);
      cursor: pointer;
      margin-top: 8px;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    .card-note-toggle:hover { color: var(--accent); }
    .card-note-toggle.has-note { color: #d4a000; }
    
    .card-note-area {
      display: none;
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px dashed var(--border);
    }
    
    .card-note-area.open { display: block; }
    
    .card-note-input {
      width: 100%;
      min-height: 60px;
      background: var(--note-bg);
      border: 1px solid var(--note-border);
      color: var(--text);
      font-family: 'Inter', sans-serif;
      font-size: 12px;
      padding: 8px;
      resize: vertical;
    }
    
    .card-note-input::placeholder { color: var(--text-dim); }
    .card-note-input:focus { outline: none; border-color: var(--accent); }
    
    .note-hint {
      font-family: 'JetBrains Mono', monospace;
      font-size: 9px;
      color: var(--text-dim);
      margin-top: 4px;
    }
    
    /* Modal */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.8);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    
    .modal-overlay.open { display: flex; }
    
    .modal {
      background: var(--surface);
      border: 1px solid var(--border);
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow: auto;
      padding: 24px;
    }
    
    .modal h2 {
      font-family: 'JetBrains Mono', monospace;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      margin-bottom: 16px;
      color: var(--accent);
    }
    
    .modal pre {
      background: var(--bg);
      border: 1px solid var(--border);
      padding: 16px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 11px;
      overflow: auto;
      white-space: pre-wrap;
      max-height: 400px;
    }
    
    .modal-actions {
      margin-top: 16px;
      display: flex;
      gap: 8px;
    }
    
    footer {
      margin-top: 32px;
      padding-top: 16px;
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      font-family: 'JetBrains Mono', monospace;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }
    
    footer a { color: var(--text-dim); text-decoration: none; }
    footer a:hover { color: var(--accent); }
    footer .refresh-note { color: var(--text-dim); }
    
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: var(--bg); }
    ::-webkit-scrollbar-thumb { background: var(--border); }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">
        <span class="accent">FR491L3</span>
        <span class="dim">√ó</span>
        <span>RAPHAEL</span>
        <span class="dim">PROJECT_BOARD</span>
      </div>
      <div class="header-right">
        <div class="last-updated" id="lastUpdated">LOADING...</div>
        <button class="header-btn" id="exportNotes" title="Export notes for Fragile">üìã NOTES</button>
        <button class="header-btn" id="themeToggle" title="Toggle theme">‚óê</button>
      </div>
    </header>
    
    <div class="board" id="board"></div>
    
    <footer>
      <div>
        <a href="search.html">üîç SEARCH</a> ¬∑ 
        <a href="status.html">‚ö° STATUS</a> ¬∑ 
        <a href="genai-kb.html">KNOWLEDGEBASE</a> ¬∑ 
        <a href="https://github.com/fr491l3b0t/kanban">GITHUB</a>
      </div>
      <div class="refresh-note">NOTES AUTO-SAVE</div>
    </footer>
  </div>
  
  <div class="modal-overlay" id="notesModal">
    <div class="modal">
      <h2>üìã Notes for Fragile Bot</h2>
      <p style="font-size:12px;color:var(--text-secondary);margin-bottom:12px;">Copy this and send to me on Telegram, or I'll check it during my next review.</p>
      <pre id="notesExport"></pre>
      <div class="modal-actions">
        <button class="header-btn" id="copyNotes">COPY TO CLIPBOARD</button>
        <button class="header-btn" id="closeModal">CLOSE</button>
      </div>
    </div>
  </div>

  <script>
    // Storage
    const NOTES_KEY = 'kanban_notes';
    let notes = JSON.parse(localStorage.getItem(NOTES_KEY) || '{}');
    let boardData = null;
    
    function saveNotes() {
      localStorage.setItem(NOTES_KEY, JSON.stringify(notes));
      updateNotesButton();
    }
    
    function updateNotesButton() {
      const btn = document.getElementById('exportNotes');
      const hasNotes = Object.values(notes).some(n => n && n.trim());
      btn.classList.toggle('has-notes', hasNotes);
      btn.textContent = hasNotes ? 'üìã NOTES (' + Object.values(notes).filter(n => n && n.trim()).length + ')' : 'üìã NOTES';
    }
    
    // Theme
    const theme = localStorage.getItem('theme') || 'dark';
    document.documentElement.setAttribute('data-theme', theme);
    
    document.getElementById('themeToggle').addEventListener('click', () => {
      const current = document.documentElement.getAttribute('data-theme');
      const next = current === 'dark' ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', next);
      localStorage.setItem('theme', next);
    });
    
    // Export notes
    document.getElementById('exportNotes').addEventListener('click', () => {
      if (!boardData) return;
      
      const notesWithContext = [];
      boardData.columns.forEach(col => {
        col.cards.forEach(card => {
          if (notes[card.id] && notes[card.id].trim()) {
            notesWithContext.push({
              card: card.title,
              column: col.title.replace(/[^\w\s]/g, '').trim(),
              note: notes[card.id].trim(),
              cardId: card.id
            });
          }
        });
      });
      
      if (notesWithContext.length === 0) {
        document.getElementById('notesExport').textContent = 'No notes yet. Click "+ NOTE" on any card to add one.';
      } else {
        document.getElementById('notesExport').textContent = JSON.stringify(notesWithContext, null, 2);
      }
      
      document.getElementById('notesModal').classList.add('open');
    });
    
    document.getElementById('copyNotes').addEventListener('click', () => {
      const text = document.getElementById('notesExport').textContent;
      navigator.clipboard.writeText(text);
      document.getElementById('copyNotes').textContent = 'COPIED!';
      setTimeout(() => document.getElementById('copyNotes').textContent = 'COPY TO CLIPBOARD', 2000);
    });
    
    document.getElementById('closeModal').addEventListener('click', () => {
      document.getElementById('notesModal').classList.remove('open');
    });
    
    document.getElementById('notesModal').addEventListener('click', (e) => {
      if (e.target.id === 'notesModal') {
        document.getElementById('notesModal').classList.remove('open');
      }
    });
    
    async function loadBoard() {
      try {
        const res = await fetch('data.json?' + Date.now());
        boardData = await res.json();
        renderBoard(boardData);
        updateNotesButton();
      } catch (err) {
        console.error('Failed to load board:', err);
      }
    }
    
    function renderBoard(data) {
      const board = document.getElementById('board');
      const lastUpdated = document.getElementById('lastUpdated');
      
      const date = new Date(data.lastUpdated);
      lastUpdated.textContent = 'UPDATED ' + date.toLocaleDateString('en-AU', { 
        day: '2-digit', month: 'short', hour: '2-digit', minute: '2-digit'
      }).toUpperCase();
      
      board.innerHTML = data.columns.map(col => `
        <div class="column column-${col.id}">
          <div class="column-header">
            ${col.title}
            <span class="column-count">${col.cards.length}</span>
          </div>
          <div class="cards">
            ${col.cards.map(card => {
              const hasNote = notes[card.id] && notes[card.id].trim();
              return `
              <div class="card ${hasNote ? 'has-note' : ''}" data-id="${card.id}">
                <div class="card-title">${card.title}</div>
                ${card.description ? `<div class="card-description">${card.description}</div>` : ''}
                <div class="card-tags">
                  ${(card.tags || []).map(tag => 
                    `<span class="tag tag-${tag}">${tag.replace('-', ' ')}</span>`
                  ).join('')}
                </div>
                ${card.completedDate ? `<div class="completed-date">‚úì ${card.completedDate}</div>` : ''}
                <div class="card-note-toggle ${hasNote ? 'has-note' : ''}" onclick="toggleNote('${card.id}')">
                  ${hasNote ? 'üìù VIEW NOTE' : '+ NOTE'}
                </div>
                <div class="card-note-area" id="note-area-${card.id}">
                  <textarea class="card-note-input" 
                    id="note-${card.id}" 
                    placeholder="Note for Fragile Bot..."
                    onchange="updateNote('${card.id}', this.value)"
                    onkeyup="updateNote('${card.id}', this.value)">${notes[card.id] || ''}</textarea>
                  <div class="note-hint">Auto-saved ‚Ä¢ Click "NOTES" to export</div>
                </div>
              </div>
            `}).join('')}
          </div>
        </div>
      `).join('');
    }
    
    function toggleNote(cardId) {
      const area = document.getElementById('note-area-' + cardId);
      area.classList.toggle('open');
      if (area.classList.contains('open')) {
        document.getElementById('note-' + cardId).focus();
      }
    }
    
    function updateNote(cardId, value) {
      notes[cardId] = value;
      saveNotes();
      // Update card styling
      const card = document.querySelector(`.card[data-id="${cardId}"]`);
      const toggle = card.querySelector('.card-note-toggle');
      const hasNote = value && value.trim();
      card.classList.toggle('has-note', hasNote);
      toggle.classList.toggle('has-note', hasNote);
      toggle.textContent = hasNote ? 'üìù VIEW NOTE' : '+ NOTE';
    }
    
    loadBoard();
    setInterval(loadBoard, 60000); // Refresh every 60s (less aggressive)
  </script>
</body>
</html>
